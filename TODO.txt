####################### DEVELOPMENT ############################

### v1.0 ###

NEXT
- enhance list view
-- filter IRIs by statement predicate/object (e.g. rdf:type schema:Person)
--- http://lod.academy.local/wiag/about.html?tx_lod_api[predicate]=rdf:type&tx_lod_api[object]=schema:Person
---- if only predicate : all IRIs that have a statement with this predicate
---- if predicate AND object : all IRIs that have a statement matching this pattern
-- search IRIs by label and comment
--- http://lod.academy.local/wiag/about.html?tx_lod_api[search]=Agerich
-- sort list by value or label
--- http://lod.academy.local/wiag/about.html?tx_lod_api[page]=3&tx_lod_api[limit]=50&tx_lod_api[sortBy]=1|2

- api plugin
-- TS setting: displayMode = 1|2|3 (only entities, only properties, both - default)
-- TS setting: excludeFromList = page1, page2, page3 (still accessible in single view)

- enhance single view
-- if graph IRI display statements in graph
--- showAction() => $this->graphRepository->findByIri(Iri) => $this->view->assign('graph', $graph)
--- in template: if {graph} then display graph, else {resource}
---- graph template displays the IRI and then all statements in the graph
--- this implements direct graph display in API accoding to https://www.w3.org/TR/sparql11-http-rdf-update/

BE
- Add TSConfig option: statementIriTypeFilter.subject = 1|2
- Add namespacesToIncludeInPrologue field to api plugin flexform

FE
- bug in HTML view: links to show action contain broken list page param and miss limit param
-- http://lod.academy.local/wiag/id/wiag:WIAG-Pers-EPISCGatz-5167-001/about.html?tx_lod_api__page=2

- ensure 9.5 compatibility
-- test serializer plugin
-- test vocabulary plugin
-- templates
--- send iris in iri param through urlencode
--- think about htmlspecialchars

- HTML view: should IRI links really always point back to API ??
-- but then: how would you filter a list by rdf:type if it points outwards?

- definedNamespaces condition in ttl, nt, json, rdfa templates

-- type param rewriting error in TYPO3 9.5
--- throw correct error if iri not found

DATA
- create ext_tables_static+adt.sql
-- set static namespaces: rdf, rdfs, owl, dc, dcterms, void, skos
--- https://ogp.me/
--- https://github.com/schemaorg/schemaorg/blob/master/data/releases/5.0/all-layers-properties.csv
--- https://www.dublincore.org/specifications/dublin-core/dcmi-terms/#elements-title
-- maybe create all rdf/rdfs Classes/Properties?

BACKPORTS
- bug in 7.6 ttl & nt templates (list view) => iri param => tx_lod_api[iri] param
- missing ' in AlternativeSerialization.nt in if condition

### v1.1 ###

- inverse properties
-- if IRI type 2 (property) add group field "inverse of" (bidirectional mm relation shown from both sides)
-- https://www.semanticarts.com/named-property-inverses-yay-or-nay/
-- http://richard.cyganiak.de/blog/2006/06/an-rdf-design-pattern-inverse-property-labels/

- AboutController / IriRepository: add possibility/setting to retrieve statements by object
-- generally for all IRIs by TypoScript
-- checkbox in statement: "Allow inversion"

- statement/sparql plugin (similar to api plugin)
-- support for basic SPARQL select queries
--- http://base.url/typo3-plugin-page?query=XYZ
-- filter statement list with graph param
--- https://www.w3.org/TR/sparql11-http-rdf-update/
--- http://base.url/typo3-plugin-page?qraph=http://base.url/id/graph => list of statements belonging to graph record

- named graphs
-- add named graph structures to ttl, json-ld and nt templates
-- maybe graph could serve as collection of statements added to records etc.

- backend
-- TCA optimization: addRecord fieldControl as popup ?

- create extension with schema.org vocab

- hydra:view has no alternative serialisations in none of the serialisation formats

### v1.2 ###

- vocabulary importer

- api plugin
-- think about cacheable actions => configurable cHash calculation during redirection => check performance

- resolver
-- call different typolink handlers according to $representation->getAuthority();
-- implement language negotiation

####################### DOCUMENTATION ############################

### TSCONFIG SETTINGS ###

tx_lod {
    settings {
        identifierGenerator {

            tx_lod_domain_model_iri {

                # type = Digicademy\Lod\Generator\UidIdentifierGenerator,
                # type = Digicademy\Lod\Generator\UuidIdentifierGenerator,
                # type = Digicademy\Lod\Generator\ForeignRecordTablenameUidIdentifierGenerator,
                # type = Digicademy\Lod\Generator\ForeignRecordFieldIdentifierGenerator,
                # type = Vendor\Package\My\Generator

                Digicademy\Lod\Generator\UidIdentifierGenerator {
                    entityPrefix = E
                    propertyPrefix = P
                }
                Digicademy\Lod\Generator\UuidIdentifierGenerator {
                    entityPrefix = E
                    propertyPrefix = P
                    xmlConformance = 1
                }
                Digicademy\Lod\Generator\ForeignRecordTablenameUidIdentifierGenerator {
                    entityPrefix = E
                    propertyPrefix = P
                    includeTablename = 1
                }
                Digicademy\Lod\Generator\ForeignRecordFieldIdentifierGenerator {
                    entityPrefix = E
                    propertyPrefix = P
                    foreignFieldName = my_foreign_field
                }
            }

            tx_lod_domain_model_bnode {

                # type = Digicademy\Lod\Generator\UidIdentifierGenerator,
                # type = Digicademy\Lod\Generator\UuidIdentifierGenerator,
                # type = Vendor\Package\My\Generator

                Digicademy\Lod\Generator\UidIdentifierGenerator {
                    bnodePrefix = b
                }
                Digicademy\Lod\Generator\UuidIdentifierGenerator, {
                    bnodePrefix = b
                    xmlConformance = 1
                }
            }
        }

        # tables also have to be registered in extension configuration
        tableTracking {
            tx_my_table {

                track = 1
                iriPidList = 1,2,3,...
                iriPidList.recursive = 1
                hideUnhide = 1
                deleteUndelete = 1

                # stdWrap on all properties and tracked record as $cobj->data
                iri {
                    type =
                    namespace =
                    label =
                    label_language =
                    comment =
                    comment_language =
                }

                # stdWrap on all properties and tracked record as $cobj->data
                representations {
                    1 {
                        pid =
                        scheme =
                        authority  =
                        path =
                        query =
                        fragment =
                        content_type =
                        content_language =
                    }
                    2 { ... }
                }

                # stdWrap on all properties and tracked record as $cobj->data
                statements {
                    1 {
                        pid =
                        predicate =
                        object =
                        object_type =
                        graph = 1
                        recursion = 1
                    }
                    2 { ... }
                }

            }
        }

        # @TODO: see IRI TCA for details
        statementIriTypeFilter {
            subject = 1|2
        }

    }
}

### RESOLVER / LINK HANDLER CONFIGURATION ###

# in PageTSconfig

TCEMAIN.linkHandler.MY_HANDLER_KEYWORD {
    handler = TYPO3\CMS\Recordlist\LinkHandler\RecordLinkHandler
    label = LLL:EXT:my_ext/Resources/Private/Language/locallang.xlf:link.customTab
    configuration {
        table = my_table
    }
    scanBefore = page
}

# in TypoScript

config.recordLinks.MY_HANDLER_KEYWORD {
    typolink {
        parameter = PAGE_ID
        additionalParams.data = field:uid
        additionalParams.wrap = &tx_my_plugin[record]=|&tx_my_plugin[action]=myAction&tx_my_plugin[controller]=MyController
        section.data = field:fragment
        useCacheHash = 1
    }
}

### LOD API CONFIGURATION ###

plugin.tx_lod_api {

    settings {

        list {
            excludeFromList = page1, page2, page3
            displayMode = 1|2|3
        }

#        show {
#        }

        # map items to generic domainObject
        persistence.classes {
            My\Class.mapping.tableName = tx_extension_domain_model_xyz
        }

        # URI resolver configuration
        resolver {
            # each scheme can have its own custom resolver
#            scheme {
#                # each resolver should implement one standard resolving mechanism for all authorities in this scheme
#                # it should also respect special configurations specified authorities that should be treated different
#                authority {
#                    # typolink configuration ($cObj->data is current representation record)
#                }
#            }

            t3 {
                # the t3 scheme implements the TYPO3 linkhandler (from 8.7 onwards but with backwards comp. for 7.6)
                # each authority equals / can have it's own linkhandler (=linkhander keyword)
                # the record authority implements the generic record linkhandler
                record < config.recordLinks.image
            }

            http {
                my\.domain\.com {
                    # typolink configuration ($cObj->data is current representation record)
                }
            }

            https < .http
        }
    }
}

### SERIALIZER CONFIGURATION ###

page.headerData.333 = USER
page.headerData.333 {
    userFunc = TYPO3\CMS\Extbase\Core\Bootstrap->run
    extensionName = Lod
    pluginName = Serializer
    vendorName = Digicademy
    persistence.storagePid = PID
    settings < plugin.tx_lod_serializer.settings
    view < plugin.tx_lod_serializer.view
}

plugin.tx_lod_serializer {
    settings {
        selectedIri = UID
        mode = embedded
        apiPage = PID
        recordToArgumentMapping {
            pages {
                argumentName = id
            }
            tx_hisodat_domain_model_persons {
                pluginNamespace = tx_hisodat_registers
                argumentName = person
            }
        }
        format {
            default = jsonld
            tx_my_table = FORMAT (jsonld, ttl, rdfxml, nt)
        }
    }
}

### SPEAKING URIs CONFIGURATION ###

#routeEnhancers:
#  ApiPlugin:
#    type: Extbase
#    limitToPages:
#      - x
#      - y
#    extension: Lod
#    plugin: Api
#    routes:
#      -
#        routePath: '/id/{iri}'
#        _controller: 'Api::about'
#        _arguments:
#          iri: iri
#    defaultController: 'Api::about'
#  PageTypeSuffix:
#    type: PageType
#    default: ''
#    map:
#      .html: 0
#      /about.html: 1991
#      /about.rdf: 2004
#      /about.ttl: 2011
#      /about.nt: 2013
#      /about.json: 2014
